import{render as uhtml}from"uhtml";export{html,svg}from"uhtml";export default function ardi(t){const e=Object.keys(t.props||{}),s=new Event("update");class n extends HTMLElement{constructor(){super().attachShadow({mode:"open"}),Object.assign(this,t),this.refs={},e.forEach((t=>{const[e,s]=this.props[t];Object.defineProperty(this,t,{get:()=>{const n=this.getAttribute(t)||s;switch(e){case String:return n;case Boolean:return[!0,"true"].includes(n);default:return e(n)}},set:e=>this.setAttribute(t,e)})}));const n=t=>{if(null===t||"object"!=typeof t)return t;for(const e in t)t[e]=n(t[e]);return new Proxy(t,{get:(t,e)=>t[e],set:(t,e,i)=>(t[e]=n(i),this.dispatchEvent(s),!0),deleteProperty:(t,e)=>(delete t[e],this.dispatchEvent(s),!0)})};"function"==typeof this.state&&(this._state=n(this.state()),delete this.state,Object.keys(this._state).forEach((t=>{Object.defineProperty(this,t,{get:()=>this._state[t],set:e=>this._state[t]=e})}))),"function"==typeof this.intersect&&new IntersectionObserver((t=>t.forEach((t=>{t.isIntersecting&&this.intersect(t.intersectionRatio.toFixed(2))}))),{root:null,rootMargin:"0px",threshold:[.1,.2,.3,.4,.5,.6,.7,.8,.9,1]}).observe(this)}context(t){if(this._ctx||(this._ctx={}),this._ctx[t])return this._ctx[t];{const e=(t,e=this)=>function e(s){if(!s||s===document||s===window)return null;let n=s.closest(t);return n||e(s.getRootNode().host)}(e);return this._ctx[t]=e(`[context=${t}]`),this._ctx[t].addEventListener("update",(()=>this.dispatchEvent(s))),this._ctx[t]}}debounce(t){var e;return function(){var s=this,n=arguments;e&&window.cancelAnimationFrame(e),e=window.requestAnimationFrame((function(){t.apply(s,n)}))}}render(){uhtml(this.shadowRoot,this.template()),this.shadowRoot.querySelectorAll("[ref]").forEach((t=>{this.refs[t.getAttribute("ref")]=t}))}connectedCallback(){this.addEventListener("update",this.debounce(this.render)),this.dispatchEvent(s),this?.ready&&this.ready()}static get observedAttributes(){return e}attributeChangedCallback(){this.dispatchEvent(s)}}!customElements.get(t.component)&&customElements.define(t.component,n)}